<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>TMA Shop - Sản phẩm</title>
  <link rel="icon" th:href="@{/img/favicon.png}" href="../static/img/favicon.png" />
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" href="../static/css/bootstrap.min.css" />
  <!-- animate CSS -->
  <link rel="stylesheet" th:href="@{/css/animate.css}" href="../static/css/animate.css" />
  <!-- owl carousel CSS -->
  <link rel="stylesheet" th:href="@{/css/owl.carousel.min.css}" href="../static/css/owl.carousel.min.css" />
  <!-- nice select CSS -->
  <link rel="stylesheet" th:href="@{/css/nice-select.css}" href="../static/css/nice-select.css">
  <!-- font awesome CSS -->
  <link rel="stylesheet" th:href="@{/css/all.css}" href="../static/css/all.css" />
  <!-- flaticon CSS -->
  <link rel="stylesheet" th:href="@{/css/flaticon.css}" href="../static/css/flaticon.css" />
  <link rel="stylesheet" th:href="@{/css/themify-icons.css}" href="../static/css/themify-icons.css" />
  <!-- font awesome CSS -->
  <link rel="stylesheet" th:href="@{/css/magnific-popup.css}" href="../static/css/magnific-popup.css" />
  <!-- swiper CSS -->
  <link rel="stylesheet" th:href="@{/css/slick.css}" href="../static/css/slick.css" />
  <link rel="stylesheet" th:href="@{/css/price_rangs.css}" href="../static/css/price_rangs.css" />
  <!-- style CSS -->
  <link rel="stylesheet" th:href="@{/css/style.css}" href="../static/css/style.css" />
  <link rel="stylesheet" th:href="@{/css/scroll.css}" href="../static/css/scroll.css" />
</head>

<body>
<!--::header part start::-->
<header class="main_menu home_menu">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-12">
        <nav class="navbar navbar-expand-lg navbar-light">
          <a class="navbar-brand" th:href="@{/}" href="index.html">
            <img th:src="@{/img/logo.png}" src="../static/img/logo.png" alt="logo" />
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                  aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="menu_icon"><i class="fas fa-bars"></i></span>
          </button>
          
          <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" th:href="@{/products}" href="productList.html">Sản
                  phẩm</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" th:href="@{/blog}" href="blog.html">Cập nhật</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" th:href="@{/about}" href="about.html">Giới thiệu</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" th:href="@{/contact}" href="contact.html">Liên hệ</a>
              </li>
            </ul>
          </div>
          <div class="hearer_icon d-flex">
            <a id="search_1" href="javascript:void(0)"><i class="ti-search"></i></a>
            <div class="cart">
              <a href="/cart">
                <i class="fas fa-cart-plus"></i>
                <span th:fragment="cart_frag"> <span id="numberCart">0</span></span>
              </a>
            </div>
            <div class="dropdown customer">
              <p id="loginout" style="color: white; display: flex; align-items:center; justify-content: center; " sec:authorize="isAnonymous()"> <a class="nav-link" href="/login">Đăng nhập</a> / <a class="nav-link" href="/register">Đăng ký</a></p>
              <a sec:authorize="isAuthenticated()" class="nav-link dropdown-toggle" href="#" id="navbarDropdown_1"
                 role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display: flex; justify-content: center; align-items: center;">
                <p style="color: white;">
                  Xin chào,
                  <span th:text="${#authentication.getPrincipal().getFullName()}"></span>
                  <span style="display: none;" id="useremail" th:text="${#authentication.getPrincipal().getEmail()}"></span>
                </p>
              </a>
              <div sec:authorize="isAuthenticated()" class="dropdown-menu" aria-labelledby="navbarDropdown_1" style="display: block; width: 220px;">
                <a th:href="@{/profile}" href="user/profile.html" class="dropdown-item">Profile</a>
                <a sec:authorize="hasRole('ROLE_ADMIN')" th:href="@{/admin}" class="dropdown-item">Quản lý</a>
                <a th:href="@{/wishlist}" href="user/wishList.html" class="dropdown-item">Sản phẩm
                  đã thích</a>
                <a th:href="@{/logout}" href="index.html" class="dropdown-item">Đăng
                  xuất</a>
              </div>
            </div>
          </div>
        </nav>
      </div>
    </div>
  </div>
  <div class="search_input" id="search_input_box">
    <div class="container ">
      <form class="d-flex justify-content-between search-inner" th:action="@{/products/search}" th:method="get">
        <input type="text" class="form-control" id="search_input" placeholder="Tìm kiếm" th:name="keyword" th:value="${keyword}">
        <button type="submit" class="btn"></button>
        <span class="ti-close" id="close_search" title="Close Search"></span>
      </form>
    </div>
  </div>
</header>
<!-- Header part end-->

<!--================Home Banner Area =================-->

<!--================Category Product Area =================-->
<section class="cat_product_area section_padding" style="padding-top: 84px;">
  <div class="container">
    <div class="row">
      <div class="col-lg-3">
        <div class="left_sidebar_area">
          <form th:action="@{/products/filter}" >
            <aside class="left_widgets p_filter_widgets">
              <div class="l_w_title">
                <h3>Hệ điều hành</h3>
              </div>
              <div class="input-group-icon mt-10">
                <div class="form-select" id="default-select">
                  <select th:name="os" th:value="${os}">
                    <option value="0">Tất cả</option>
                    <th:block th:each="category : ${categoryList}">
                      <option th:value="${category.getId()}" th:text="${category.getName()}"></option>
                    </th:block>
                  </select>
                </div>
              </div>
            </aside>
            <aside class="left_widgets p_filter_widgets">
              <div class="l_w_title">
                <h3>Bộ nhớ RAM</h3>
              </div>
              <div class="input-group-icon mt-10">
                <div class="form-select" id="default-select-2">
                  <select th:name="ram" th:value="${ram}">
                    <option value="0">Tất cả</option>
                    <th:block th:each="ram : ${ramList}">
                      <option th:value="${ram}" th:text="${ram + 'GB'}"></option>
                    </th:block>
                  </select>
                </div>
              </div>
            </aside>
            <aside class="left_widgets p_filter_widgets">
              <div class="l_w_title">
                <h3>Bộ nhớ ROM</h3>
              </div>
              <div class="input-group-icon mt-10">
                <div class="form-select" id="default-select-3">
                  <select th:name="rom" th:value="${rom}">
                    <option value="0">Tất cả</option>
                    <th:block th:each="rom : ${romList}">
                      <option th:value="${rom}" th:text="${rom + 'GB'}"></option>
                    </th:block>
                  </select>
                </div>
              </div>
            </aside>
            
            <aside class="left_widgets p_filter_widgets price_rangs_aside">
              <div class="l_w_title">
                <h3>Giá cả</h3>
              </div>
              <div class="widgets_inner">
                <div class="range_item">
                  <!-- <div id="slider-range"></div> -->
                  <input type="text" class="js-range-slider" value="" />
                  <div class="d-flex">
                    <div class="price_text">
<!--                      <p>Price :</p>-->
                    </div>
                    <div class="price_value d-flex justify-content-center">
                      <span> $ </span>
                      <input th:name="priceFrom" th:value="${priceFrom}" type="text" class="js-input-from" id="amountFrom" readonly />
                      <span>đến</span>
                      <span> $ </span>
                      <input th:name="priceTo" th:value="${priceTo}" type="text" class="js-input-to" id="amountTo" readonly />
                    </div>
                  </div>
                </div>
              </div>
            </aside>
            <aside class="left_widgets p_filter_widgets" style="display: flex; align-items: center; justify-content: center;">
              <button type="submit" class="btn btn-primary">Lọc sản phẩm</button>
            </aside>
          </form>
        </div>
      </div>
      <div class="col-lg-9">
        <div class="row">
          <div class="col-lg-12">
            <div class="product_top_bar d-flex justify-content-between align-items-center">
              <div class="single_product_menu">
                <p> Tìm thấy <span th:text="${totalItems}"></span> sản phẩm</p>
              </div>
              <div class="single_product_menu d-flex">
                <h5>Sắp xếp theo: </h5>
                <select>
                  <option value="newest">Mới nhất</option>
                  <option value="name">Theo tên</option>
                  <option value="lowprice">Giá thấp</option>
                  <option value="highprice">Giá cao</option>
                </select>
              </div>
              <div class="single_product_menu d-flex">
                <div class="input-group">
                  
                  <form th:action="@{/products/search}">
                    <input name="keyword" th:text="${keyword}" type="text" class="form-control" placeholder="Tìm kiếm" aria-describedby="inputGroupPrepend">
                  </form>
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="inputGroupPrepend"><i class="ti-search"></i></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row align-items-center latest_product_inner">
          <th:block th:each="item:${productList}">
            <div class="col-lg-4 col-sm-6">
              <div class="single_product_item">
                <a href="#abc" th:href="@{${'/products/'+item.getId()}}"><img th:src="@{${'/productImages/' + item.getImage()}}" src="/img/offer_img.jpg" alt=""></a>
                <div class="single_product_text">
                  <a href="#abc" th:href="@{${'/products/'+item.getId()}}">
                    <h4 th:text="${item.getName()}">Quartz Belt Watch</h4>
                  </a>
                  <a href="#abc" th:href="@{${'/products/'+item.getId()}}">
                    <h3 th:text="${'$ ' + item.getPrice()}">$150.00</h3>
                  </a>
                  <span sec:authorize="isAuthenticated()">
                        <a class="add_cart">
                          <p style="display: none;" th:text="${item.getId()}"></p>
                          <span class="clickme" th:if="${item.getQuantity()} > 0">+ Thêm vào giỏ</span>
                          <!--                          <span th:if="${item.getQuantity()} > 0" onclick="updateOutput()">+ Thêm vào giỏ</span>-->
                          <span style="cursor: not-allowed;" th:if="${item.getQuantity()} <= 0">Hết hàng</span>
                          <i class="ti-heart addToWishList"></i>
                        </a>
                    <!--                        <a th:href="@{${'/addToWishList/'+item.getId()}}" style="color:black;">-->
    
                    <!--                          <span th:fragment="wishList_frag" style="display: none"></span>-->
                    <!--                          </a>-->
                      </span>
                </div>
              </div>
            </div>
          </th:block>
          <div class="col-lg-12">
            <div class="pageination">
              <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center">
                  <li class="page-item">
                    <a class="page-link" href="#" aria-label="Previous">
                      <i class="ti-angle-double-left"></i>
                    </a>
                  </li>
                  <li class="page-item"><a class="page-link" href="#">1</a></li>
                  <li class="page-item"><a class="page-link" href="#">2</a></li>
                  <li class="page-item"><a class="page-link" href="#">3</a></li>
                  <li class="page-item"><a class="page-link" href="#">4</a></li>
                  <li class="page-item"><a class="page-link" href="#">5</a></li>
                  <li class="page-item"><a class="page-link" href="#">6</a></li>
                  <li class="page-item">
                    <a class="page-link" href="#" aria-label="Next">
                      <i class="ti-angle-double-right"></i>
                    </a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!--================End Category Product Area =================-->

<!-- product_list part start-->
<section class="product_list section_padding">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-12">
        <div class="section_tittle text-center">
          <h2>Hot <span>shop</span></h2>
        </div>
      </div>
    </div>
    <div class="row align-items-center justify-content-between">
      <div class="col-lg-12">
        <div class="best_product_slider owl-carousel">
          <th:block th:each="productHot:${productListHot}">
            <div class="single_product_item">
              <a href="#abc"><img th:src="@{${'/productImages/'+productHot.getImage()}}" src="../static/img/offer_img.jpg" alt="" /></a>
              <div class="single_product_text">
                <a href="#abc">
                  <h4 th:text="${productHot.getName()}">Quartz Belt Watch</h4>
                </a>
                <a href="#abc">
                  <h3 th:text="${productHot.getPrice()}">$150.00</h3>
                </a>
                <a href="#" class="add_cart">+ add to cart<i class="ti-heart"></i></a>
              </div>
            </div>
          </th:block>
      
      
      
        </div>
      </div>
    </div>
  </div>
</section>
<!-- product_list part end-->

<!--::footer_part start::-->
<footer class="footer_part">
  <div class="copyright_part">
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <div class="copyright_text">
            <p>
              <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
              Copyright &copy;
              <script>
                document.write(new Date().getFullYear());
              </script>
              All rights reserved | This template is used with
              <i class="ti-heart" aria-hidden="true"></i> by
              <a href="https://www.facebook.com/tung.buivan.sfer.11235/" target="_blank">Tungsfer</a>
            </p>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="footer_icon social_icon">
            <ul class="list-unstyled">
              <li>
                <a href="#" class="single_social_icon"><i class="fab fa-facebook-f"></i></a>
              </li>
              <li>
                <a href="#" class="single_social_icon"><i class="fab fa-twitter"></i></a>
              </li>
              <li>
                <a href="#" class="single_social_icon"><i class="fas fa-globe"></i></a>
              </li>
              <li>
                <a href="#" class="single_social_icon"><i class="fab fa-behance"></i></a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>
<!--::footer_part end::-->

<!-- jquery plugins here-->
<script th:src="@{/js/jquery-1.12.1.min.js}" src="../static/js/jquery-1.12.1.min.js"></script>
<!-- popper js -->
<script th:src="@{/js/popper.min.js}" src="../static/js/popper.min.js"></script>
<!-- bootstrap js -->
<script th:src="@{/js/bootstrap.min.js}" src="../static/js/bootstrap.min.js"></script>
<!-- easing js -->
<script th:src="@{/js/jquery.magnific-popup.js}" src="../static/js/jquery.magnific-popup.js"></script>
<!-- swiper js -->
<script th:src="@{/js/swiper.min.js}" src="../static/js/swiper.min.js"></script>
<!-- swiper js -->
<script th:src="@{/js/masonry.pkgd.js}" src="../static/js/masonry.pkgd.js"></script>
<!-- particles js -->
<script th:src="@{/js/owl.carousel.min.js}" src="../static/js/owl.carousel.min.js"></script>
<script th:src="@{/js/jquery.nice-select.min.js}" src="../static/js/jquery.nice-select.min.js"></script>
<!-- slick js -->
<script th:src="@{/js/slick.min.js}" src="../static/js/slick.min.js"></script>
<script th:src="@{/js/jquery.counterup.min.js}" src="../static/js/jquery.counterup.min.js"></script>
<script th:src="@{/js/waypoints.min.js}" src="../static/js/waypoints.min.js"></script>
<script th:src="@{/js/contact.js}" src="../static/js/contact.js"></script>
<script th:src="@{/js/jquery.ajaxchimp.min.js}" src="../static/js/jquery.ajaxchimp.min.js"></script>
<script th:src="@{/js/jquery.form.js}" src="../static/js/jquery.form.js"></script>
<script th:src="@{/js/jquery.validate.min.js}" src="../static/js/jquery.validate.min.js"></script>
<script th:src="@{/js/mail-script.js}" src="../static/js/mail-script.js"></script>
<!-- custom js -->
<script th:src="@{/js/stellar.js}" src="../static/js/stellar.js"></script>
<script th:src="@{/js/price_rangs.js}" src="../static/js/price_rangs.js"></script>
<!-- custom js -->
<script th:src="@{/js/custom.js}" src="../static/js/custom.js"></script>
<!--  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>-->
<script>
  $("document").ready(function () {
    var user_id ;
    var user_email = $("#useremail").text();
    console.log(user_email);
    $.get("/apis/getUserIdByEmail/" + user_email ).done(function (xxxid) {
      user_id = xxxid;
      console.log(user_id);
      if($("#loginout").length > 0) {
        console.log("not login");
      } else {
        console.log("login");
        $.get("/apis/countcart/" + user_id).done(function (fragment) {
          console.log(fragment);
          $("#numberCart").html(fragment);
        });
      }
      $(".addToWishList").click(function (e){
        var product_id = e.target.parentElement.firstElementChild.textContent;
        $.post("/addToWishList/" + product_id).done(function () {
          alert("đã thêm vào danh sách yêu thích");
        });
      });
      $(".clickme").click(function (e) {
        console.log(e.target);
        var product_id = e.target.parentElement.firstElementChild.textContent;
        console.log(product_id);
        $.post("/addToCart/" + product_id).done(function (fragment) {
          console.log(fragment);
          $.get("/apis/countcart/" + user_id).done(function (fragment) {
            console.log(fragment);
            $("#numberCart").html(fragment);
          });
        });
      });
    });
  });
  </script>
<script src="https://apps.elfsight.com/p/platform.js" defer></script>
<div class="elfsight-app-6b7c4476-cba7-4d7f-b0ef-dc55634740e3"></div>
</body>

</html>